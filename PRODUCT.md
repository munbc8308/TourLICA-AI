# TourLICA-AI Product Snapshot

## 서비스 개요
- **목표**: 외국인 관광객과 한국 관광통역사/관광 도우미를 즉시 매칭해 주는 AI 주도 플랫폼.
- **핵심 요구**: 외국인 이용자가 주 사용자이므로 영어·중국어·일본어 등 멀티랭귀지 UI/콘텐츠를 기본 지원해야 하며, 통역사 프로필과 일정 관리, 실시간 채팅이 확장 목표입니다.

## 현재 기능 개요
- **반응형 랜딩**: TourLICA 로고 + 테마 로딩 애니메이션으로 첫인상 제공, 로딩 종료 후 로그인 화면으로 자동 이동합니다.
- **로그인 화면**: 중앙 집중 폼(아이디/패스워드)과 회원가입·비밀번호 찾기, Google/Apple/카카오/네이버 소셜 버튼을 제공합니다.
- **Next.js App Router 기반**: TypeScript, ESLint, `app/` 구조를 갖춘 SSR/ISR 대응 React 런타임.
- **PostgreSQL 연동**: `pg`를 이용해 계정/여행지 데이터를 관리하며, `lib/db.ts`/`lib/accounts.ts`/`lib/destinations.ts`가 서버 컴포넌트에서 직접 쿼리합니다.
- **REST API 샘플**: `app/api/destinations`는 여행지 목록 JSON을, `app/api/events`는 Kafka 토픽으로 이벤트를 발행합니다.

## 인프라 & 개발 워크플로
- **Kafka/Redpanda 개발용 스택**: `docker-compose.yml`로 Single-node Redpanda 실행, `scripts/kafka-create-topic.sh`로 토픽 생성.
- **환경 변수 가이드**: `.env.example`에 PostgreSQL URL, Kafka, Google Maps 값을 정의해 로컬/배포 환경을 일관되게 유지.
- **빌드 호환성**: `prebuild` 단계에서 `npm run seed:postgres`를 호출해 DB에 샘플 데이터 주입 후 `npm run build`가 수행됩니다.

## 위치 기반 매칭 요구사항
- **사용자 위치 확보**: 모바일/웹에서 브라우저 geolocation 혹은 사용자 입력을 통해 현재 위치나 원하는 만남 위치를 수집해야 합니다.
- **반경 설정**: 이용자가 선호 반경(예: 2km, 5km)을 지정하면 해당 범위 내 통역사/도우미만 추천 및 매칭 후보로 노출합니다.
- **근접 알림**: 반경 내 존재하는 통역사에게 즉시 알림을 보내고, 통역사는 수락/거절로 매칭 여부를 결정할 수 있어야 합니다.
- **Kafka 알림 파이프라인**: 관광객이 도움을 신청하면 Kafka 토픽(`tourlica-events`)에 이벤트를 게시하고, 통역사/도우미 포털은 해당 토픽을 구독해 실시간으로 알림을 받고 매칭 수락 여부를 선택합니다.

## 지도 기반 UX 방향
- **메인 캔버스**: 지도를 기반으로 현재 사용자 위치, 추천 관광지, 통역사/도우미 아이콘을 동시에 시각화합니다.
- **반경 뷰어**: 사용자가 설정한 반경을 원형 오버레이로 표시하여 지원 가능 범위를 직관적으로 보여줍니다.
- **필터/언어 토글**: 지도 상단에 지원 언어·서비스 유형 필터를 배치해 외국인 이용자가 원하는 통역사를 빠르게 찾도록 합니다.

## 샘플 계정 전략
- Postgres 시드(`npm run seed:postgres`)에 관광객/통역사/도우미 계정을 포함시켜 로그인 → 지도 화면 흐름을 바로 체험할 수 있게 합니다.

## 향후 확장 아이디어
1. **다국어 UX**: i18n 라이브러리(예: `next-intl`)를 도입해 외국인 관광객이 선호 언어로 온보딩·검색·채팅을 이용하도록 합니다.
2. **실시간 매칭/챗**: WebSocket 또는 Kafka 소비자를 통해 통역사-관광객 매칭 상태를 실시간으로 반영하고, 예약/결제 단계까지 확장합니다.
3. **통역사 관리 콘솔**: 인증, 스케줄 관리, 리뷰 시스템을 위한 별도 대시보드를 추가합니다.

## 2025-11-21 가입 흐름 업데이트
- **역할 기반 온보딩**: `/signup`에 관광객·통역사·도우미 선택 란을 추가해 각 역할별로 다른 필드를 입력하도록 분기했습니다.
- **세부 정보 수집**: 이메일/패스워드 외에 연락처, 국가, 성별, 별칭, 단말기 지문(브라우저/플랫폼)까지 입력 및 자동 수집합니다. 통역사는 고유번호 필드가 추가되었습니다.
- **관리자 역할 확장**: DB 스키마가 `admin` 역할과 프로필 컬럼(nickname, phone, gender, device_fingerprint 등)을 포함하도록 확장됐으며 시드 스크립트도 동일하게 반영되었습니다.
- **API 연동**: `POST /api/auth/register` 라우트가 생성되어 역할별 유효성 검사와 중복 이메일/고유번호 체크를 수행하면서 계정을 생성합니다.
- **관광객 지도 UI**: `/map` 하단에 매칭 버튼을 추가하고, 통역사/도우미 호출 선택 → Kafka 이벤트 발송 → 파형 애니메이션/취소 버튼까지 연결되는 대기 상태를 시각화했습니다.
- **통역사/도우미 콘솔**: 동일한 `/map` 화면을 역할에 따라 전환해 Kafka 대기열을 지속 폴링하고, 새 요청이 감지되면 지도 중심을 관광객 위치로 이동 → 마커 클릭 → 매칭 수락 버튼으로 이어지는 플로우를 구현했습니다. 수락 시 `match_assignments` 테이블에 관광객/통역사/도우미 키, 위치, 시간 정보가 저장되고, 대기열(`match_requests`)에서는 항목이 제거됩니다.
- **Confluent Cloud 테스트 클라이언트**: `ccloud-nodejs-client/`에 Confluent Cloud 자격(client.properties) 기반 게시/구독 스크립트를 추가했습니다. 관광객 모드(`publish`)는 매칭 이벤트를 손쉽게 발행하고, 통역사/도우미 모드(`consume`)는 역할별로 필터링된 요청을 확인할 수 있어 원격 Kafka 인프라와의 E2E 검증이 간편해졌습니다.
- **매칭 대기 복원**: 관광객이 매칭 요청을 보낼 때마다 `match_requests` 테이블에 즉시 기록하고, `/api/match/status`로 최근 미완료 요청을 조회해 새로고침해도 기다리는 상태를 유지하도록 Map 페이지 로직을 보강했습니다. 취소 시에는 해당 레코드의 상태를 `cancelled`로 업데이트해 중복 호출을 방지합니다.
